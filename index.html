<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CURP Energético Matemático</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --text: #4b5563;
      --bg: #e9eff5;
      --card-bg: #ffffff;
      --accent: #1f2937;
      --radius: 16px;
      --shadow: 0 10px 25px rgba(0,0,0,0.08);
      --vibrant: #e63946;
      --brand: #2563eb;
      --tooltip-bg: #111827;
    }

    /* Resets útiles */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { overflow-x: hidden; }

    body { margin:0; font-family:'Montserrat',sans-serif; background:var(--bg); color:var(--text);}    
    .container{max-width:880px;margin:32px auto;padding:24px;}
    .card{background:var(--card-bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px;animation:fadeIn .8s ease;}
    @keyframes fadeIn {from{opacity:0; transform:scale(.97);} to{opacity:1; transform:scale(1);} }
    header{text-align:center;margin-bottom:18px;}
    header img.hero{display:block;margin:0 auto 16px;max-width:100%;width:880px;height:auto;border-radius:12px;}
    h1.title{margin:0;font-weight:700;font-size:clamp(1.4rem,2.2vw+1rem,2.2rem);color:var(--accent);}
    form{display:grid;gap:14px;margin-top:14px;}
    label{font-weight:600;font-size:0.95rem;display:block;margin-bottom:6px;}
    input{
      border:1px solid #d1d5db;border-radius:10px;padding:12px 14px;font-size:1rem;
      background:#fff;color:var(--text);width:100%;box-sizing:border-box;
    }
    #nombre{text-transform:uppercase;}
    input::placeholder{color:#a8b1bb;font-weight:400;}

    /* Desktop: 6ª columna para la nota */
    .grid-datetime{
      display:grid;
      grid-template-columns:90px 90px 120px 90px 90px minmax(180px, 1fr);
      gap:12px; align-items:end; justify-content:start;
    }
    .grid-datetime .col{display:flex;flex-direction:column;}
    .grid-datetime label{text-align:center;}
    .grid-datetime input.num{text-align:center;letter-spacing:1px;}

    /* Un poco más de separación entre Año y Hora en escritorio */
    .grid-datetime .dt-hora{ margin-left: 16px; }

    /* Nota (visible en desktop) */
    .time-note{
      display:block;
      grid-column: 6;
      align-self:end;
      text-align:left;
    }
    .time-note .note-content{
      display:inline-flex; align-items:center; gap:6px; position:relative;
    }
    .time-note small{ font-size:0.8rem; color:#6b7280; line-height:1.25; }

    /* Icono/tooltip accesible (desktop) */
    .info-badge{
      background:transparent; border:0; padding:2px 4px;
      font-size:0.95rem; line-height:1; cursor:help; color:#6b7280;
      border-radius:6px; touch-action:manipulation;
    }
    .info-badge:focus{ outline:2px solid #9ca3af; outline-offset:2px; }

    .tooltip{
      position:absolute; bottom:125%; left:0; transform: translateY(-6px);
      background:var(--tooltip-bg); color:#fff; padding:8px 10px;
      border-radius:8px; font-size:0.78rem; width:220px; z-index:50;
      box-shadow:0 8px 20px rgba(0,0,0,.18);
      opacity:0; pointer-events:none; transition:opacity .2s, transform .2s;
      white-space:normal;
    }
    .tooltip::after{
      content:""; position:absolute; top:100%; left:14px;
      border-width:6px; border-style:solid;
      border-color:var(--tooltip-bg) transparent transparent transparent;
    }
    .info-badge:hover + .tooltip,
    .info-badge:focus + .tooltip,
    .info-badge[data-open="true"] + .tooltip{
      opacity:1; transform: translateY(-2px); pointer-events:auto;
    }

    button{
      border:none;background:var(--brand);color:white;font-weight:600;border-radius:12px;
      padding:12px 16px;cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,0.12);
    }
    #boton{display:inline-block;width:auto;min-width:260px;align-self:start;}
    button[disabled]{opacity:.6;cursor:not-allowed;}
    #boton.ready{background:#15803d;box-shadow:0 6px 14px rgba(21,128,61,0.35);}    

    .resultado{margin-top:20px;font-size:1.6rem;font-weight:700;color:var(--vibrant);text-align:center;cursor:pointer;transition:color 0.3s ease;}
    .resultado strong{transition: color .3s ease, transform .1s ease; cursor:pointer;}
    .resultado strong:hover{color:#1d4ed8; transform:scale(1.05);}
    .instruccion{margin-top:12px;font-size:0.9rem;font-weight:400;color:var(--accent);text-align:center;line-height:1.4;animation:fadeIn 1s ease;}
    .instruccion a{color:var(--brand);text-decoration:none;}

    /* Botón pequeño “nuevo cálculo” */
    .reset-wrap{display:flex;justify-content:center;margin-top:10px;}
    .btn-reset{
      background:transparent;border:0;color:#6b7280;cursor:pointer;
      font-size:0.85rem;text-decoration:underline;padding:6px 8px;border-radius:8px;
    }
    .btn-reset:hover{ color:#374151; }

    /* Pantalla secundaria */
    #pantalla2{
      display:none;
      position:fixed;top:0;left:0;width:100%;height:100%;
      background: linear-gradient(270deg,#a5d8ff,#fff3bf,#ffc9c9);
      background-size:600% 600%;
      animation: gradientShift 15s ease infinite;
      text-align:center;padding:20px;
      box-sizing:border-box;
    }
    #pantalla2.show{display:flex;flex-direction:column;justify-content:center;align-items:center;}
    #pantalla2 h2{font-size:3rem;color:var(--vibrant);margin-bottom:20px;}
    #pantalla2 p{max-width:600px;font-size:1.2rem;line-height:1.6;color:#1f2937;}
    #pantalla2 button{margin-top:20px;}
    @keyframes gradientShift{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}

    /* Hint “Haz clic en el número” */
    .hint-tap{
      margin-top:6px;font-size:0.85rem;color:#6b7280;
      animation: hintBlink 1.2s ease-in-out infinite;
    }
    @keyframes hintBlink{ 0%,100%{opacity:0} 50%{opacity:1} }

    /* ===== MÓVIL ===== */
    @media (max-width: 640px){
      .grid-datetime{
        grid-template-columns: repeat(3, 1fr);
        grid-template-areas:
          "dia mes anio"
          "hora min info";
      }
      .grid-datetime .dt-dia{ grid-area: dia; }
      .grid-datetime .dt-mes{ grid-area: mes; }
      .grid-datetime .dt-anio{ grid-area: anio; }
      .grid-datetime .dt-hora{ grid-area: hora; margin-left:0; }
      .grid-datetime .dt-min{ grid-area: min; }

      /* ✅ Mostrar SOLO el texto; ocultar icono y tooltip en móvil */
      .time-note{ grid-area: info; display:block; }
      .time-note .info-badge,
      .time-note .tooltip{ display:none !important; }
      .time-note small{ font-size:0.78rem; line-height:1.25; }

      #boton{ width:100%; }
    }
  </style>
</head>
<body>
<div class="container" id="pantalla1">
  <div class="card">
    <header>
      <img class="hero" src="REPORTE.jpg" alt="Encabezado REPORTE" />
      <h1 class="title">CURP Energético Matemático</h1>
    </header>

    <form id="formulario" onsubmit="event.preventDefault(); calcularCURP();">
      <div class="field">
        <label for="nombre">Nombre completo:</label>
        <input id="nombre" type="text" placeholder="Ejemplo FULANITO PÉREZ Y PÉREZ" required />
      </div>

      <div class="grid-datetime">
        <div class="col dt-dia"><label for="dia">Día:</label><input id="dia" class="num" type="text" inputmode="numeric" placeholder="DD" maxlength="2" /></div>
        <div class="col dt-mes"><label for="mes">Mes:</label><input id="mes" class="num" type="text" inputmode="numeric" placeholder="MM" maxlength="2" /></div>
        <div class="col dt-anio"><label for="anio">Año:</label><input id="anio" class="num" type="text" inputmode="numeric" placeholder="AAAA" maxlength="4" /></div>
        <div class="col dt-hora"><label for="horaH">Hora:</label><input id="horaH" class="num" type="text" inputmode="numeric" placeholder="HH" maxlength="2" /></div>
        <div class="col dt-min"><label for="minutoM">Minutos:</label><input id="minutoM" class="num" type="text" inputmode="numeric" placeholder="MM" maxlength="2" /></div>
        <!-- Nota con icono y tooltip (desktop); solo texto en móvil -->
        <div class="col time-note">
          <div class="note-content">
            <small>Introduce la hora en formato de 24 hrs</small>
            <button type="button" class="info-badge" aria-label="Ayuda sobre formato de 24 horas" aria-describedby="tip-24h">ℹ️</button>
            <div class="tooltip" id="tip-24h" role="tooltip">
              Usa 00–23 para la hora. Ej.: 21:45 equivale a 9:45 pm.
            </div>
          </div>
        </div>
      </div>

      <button id="boton">Calcula tu CURP Energético</button>
      <div id="resultado" class="resultado"></div>
      <div id="instruccion" class="instruccion"></div>

      <!-- Botón pequeño para reiniciar el formulario en la pantalla 1 -->
      <div class="reset-wrap">
        <button type="button" id="btnReset" class="btn-reset">Iniciar un nuevo cálculo</button>
      </div>
    </form>
  </div>
</div>

<div id="pantalla2">
  <h2 id="numFinal"></h2>
  <p>Has recibido tu número vibracional, ahora que lo tienes recuérdalo y recítalo al menos 9 veces al día, cuando lo hagas, ten pensamientos positivos, de abundancia, de salud, de amor o de felicidad. Repítelo continuamente y verás cambios importantes en tu vida.</p>
  <button onclick="volverPantalla1()">Volver</button>
  <button onclick="copiarNumero()">Copiar número</button>
</div>

<script>
  const LETTER_VALUE = { 'A':1,'J':1,'R':1, 'B':2,'K':2,'S':2, 'C':3,'L':3,'T':3, 'D':4,'M':4,'U':4, 'E':5,'N':5,'V':5, 'F':6,'Ñ':6,'W':6, 'G':7,'O':7,'X':7, 'H':8,'P':8,'Y':8, 'I':9,'Q':9,'Z':9 };
  const ACCENT_MAP = { 'Á':'A','É':'E','Í':'I','Ó':'O','Ú':'U','Ü':'U','á':'A','é':'E','í':'I','ó':'O','ú':'U','ü':'U'};

  function normalizeName(str){
    return str.split('').map(ch=>ACCENT_MAP[ch]??ch).join('').toUpperCase().replace(/[^A-ZÑ ]/g,'').replace(/\s+/g,' ').trim();
  }
  function lettersToValues(str){
    return normalizeName(str).split('').filter(c=>c!==' ').map(c=>LETTER_VALUE[c]||0);
  }
  function reduceChain(chain){
    let groups=[]; let i=0;
    while(i+2<chain.length){
      const sum=Number(chain[i])+Number(chain[i+1])+Number(chain[i+2]);
      let red=sum;
      while(red>9){red=String(red).split('').reduce((a,b)=>a+Number(b),0);}
      groups.push(red);
      i+=3;
    }
    if(i<chain.length){ groups.push(...chain.slice(i).split('').map(Number)); }
    return groups.join('');
  }
  function fullReduce(chain){
    let c=chain;
    while(c.length>4){ c=reduceChain(c); }
    return c;
  }

  function showPantalla2(num){
    document.getElementById('pantalla1').style.display='none';
    const hint = document.getElementById('tapHint'); if (hint) hint.remove();
    const p2 = document.getElementById('pantalla2');
    document.getElementById('numFinal').textContent = num;
    p2.classList.add('show');
  }
  function volverPantalla1(){
    const p2 = document.getElementById('pantalla2');
    p2.classList.remove('show');
    document.getElementById('pantalla1').style.display='block';
    document.getElementById('boton').style.display='inline-block';
    document.getElementById('resultado').textContent='';
    document.getElementById('instruccion').textContent='';
  }
  function copiarNumero(){
    const num=document.getElementById('numFinal').textContent;
    navigator.clipboard.writeText(num).then(()=>{ alert('Número copiado: '+num); });
  }

  function setupAutoTab(){
    const order=['dia','mes','anio','horaH','minutoM'];
    order.forEach((id, idx)=>{
      const el=document.getElementById(id);
      if(!el) return;
      el.addEventListener('input', ()=>{
        el.value = el.value.replace(/[^0-9]/g,'').slice(0, el.maxLength || 4);
        if(el.value.length === (el.maxLength || 4) && idx < order.length-1){
          const next=document.getElementById(order[idx+1]);
          if(next){ next.focus(); next.select?.(); }
        }
        checkReady();
      });
      el.addEventListener('keydown', (e)=>{
        if(e.key==='Backspace' && el.value.length===0 && idx>0){
          const prev=document.getElementById(order[idx-1]);
          if(prev) prev.focus();
        }
      });
    });
  }
  function checkReady(){
    const reqLen = {dia:2, mes:2, anio:4, horaH:2, minutoM:2};
    const okName = !!document.getElementById('nombre').value.trim();
    const okNums = Object.entries(reqLen).every(([k,l]) => (document.getElementById(k).value||'').length===l);
    const ok = okName && okNums;
    const btn = document.getElementById('boton');
    if(btn){ btn.disabled = !ok; btn.classList.toggle('ready', ok); }
  }

  function resetCalculo(){
    const ids = ['nombre','dia','mes','anio','horaH','minutoM'];
    ids.forEach(id => { const el = document.getElementById(id); if(el) el.value=''; });
    document.getElementById('resultado').textContent='';
    document.getElementById('instruccion').textContent='';
    const btn = document.getElementById('boton');
    if(btn){ btn.style.display='inline-block'; btn.disabled = true; btn.classList.remove('ready'); }
    document.getElementById('nombre').focus();
  }

  function setupTooltip(){
    const btn = document.querySelector('.info-badge');
    if(!btn) return;
    const tip = btn.nextElementSibling;

    btn.addEventListener('click', (e)=>{
      const open = btn.getAttribute('data-open') === 'true';
      btn.setAttribute('data-open', open ? 'false' : 'true');
      if (matchMedia('(hover: hover)').matches) {
        setTimeout(()=>{ btn.setAttribute('data-open','false'); }, 3000);
      }
      e.stopPropagation();
    });

    document.addEventListener('click', (e)=>{
      if (!btn.contains(e.target) && !tip.contains(e.target)) {
        btn.setAttribute('data-open','false');
      }
    });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('pantalla1').style.display='block';
    document.getElementById('pantalla2').classList.remove('show');
    setupAutoTab();
    checkReady();
    const btnReset = document.getElementById('btnReset');
    if(btnReset){ btnReset.addEventListener('click', resetCalculo); }
    setupTooltip(); // en móvil el icono/tooltip no se muestra
  });

  function calcularCURP(){
    const nombre=document.getElementById('nombre').value.trim();
    const dia=document.getElementById('dia').value;
    const mes=document.getElementById('mes').value;
    const anio=document.getElementById('anio').value;
    const h=document.getElementById('horaH').value;
    const mi=document.getElementById('minutoM').value;
    if(!nombre||!dia||!mes||!anio||!h||!mi){alert('Completa todos los campos');return;}

    const nameDigits=lettersToValues(nombre).map(String);
    const dateTimeDigits=(dia+mes+anio+h+mi).split('').filter(ch=>ch!=='0');
    const cadena=[...nameDigits,...dateTimeDigits].join('');
    const result=fullReduce(cadena);

    document.getElementById('boton').style.display='none';
    const resultadoEl=document.getElementById('resultado');
    resultadoEl.innerHTML = `
      <strong id="resultNumber">${result}</strong>
      <div id="tapHint" class="hint-tap">Haz clic en el número</div>
    `;
    document.getElementById('instruccion').innerHTML =
      `Descarga la app <strong>Frequency Sound Generator</strong> en el Play Store de Google
       <a href="https://play.google.com/store/apps/details?id=com.luxdelux.frequencygenerator" target="_blank">aquí</a>,
       cambia los 440 Hz que vienen por default en la app a tu número energético, oprime el ícono de tu lado derecho que está debajo del + y selecciona <em>Square</em>. Listo, ¡Escucha tu propia frecuencia!`;

    const resNum=document.getElementById('resultNumber');
    if(resNum){ resNum.addEventListener('click',()=> showPantalla2(result)); }
  }
</script>
</body>
</html>
